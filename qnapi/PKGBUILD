# Maintainer: FadeMind <fademind@gmail.com>
# Contributor: Jakub Schmidtke <sjakub-at-gmail.com>
# Contributor: Piotr Krzemi≈Ñski <pio.krzeminski@gmail.com>

pkgname=qnapi
pkgver=0.2.2
pkgrel=3
pkgdesc="Qt5 client for downloading movie subtitles from NapiProjekt, OpenSubtitles, Napisy24"
arch=('i686' 'x86_64' 'armv7h')
url="https://github.com/QNapi/${pkgname}"
license=('GPL')
depends=('qt5-base' 'libmediainfo' 'p7zip')
changelog=ChangeLog
source=("${pkgname}-${pkgver}.tar.gz::https://github.com/QNapi/${pkgname}/releases/download/${pkgver}/${pkgname}-${pkgver}.tar.gz"
languagefix.patch
languagefix_2.patch
languagefix_3.patch
defaultsublanguage.patch
en.png)
sha256sums=('d189150944b2524e06bec3215caf4aa8503ee4f2597954cba5c2568e4a3b8a92'
            '72329d56129ee7a3fb7a34eac5b17365ac23ec8f2bc32939befa6ecac36e98cd'
            'a9f6f0c80219e29a79d731426e3e85062673b8a3773500e415bf6cea828ea79e'
            'd4f3210a8f242a1d4e70ea9270f4b46d2855b0d30445083800d3dd266078a14f'
            'f985cd7f1c75ac0913b762b94d5ea102fdb3d3dd9b4bc72e305783d25315ed73'
            '8e48a8d3e16c9e74af247fa52fc12094a31cad8d648a681831c17b479b9c898f')

prepare() {
    cd "${srcdir}/${pkgname}-${pkgver}"
    patch -Np1 -i $srcdir/languagefix.patch
    patch -Np1 -i $srcdir/languagefix_2.patch
    patch -Np1 -i $srcdir/languagefix_3.patch
    patch -Np1 -i $srcdir/defaultsublanguage.patch
    
    rm ./res/langs/en.png
    cp $srcdir/en.png ./res/langs/
}

build() {
    cd "${srcdir}/${pkgname}-${pkgver}"
    qmake-qt5 QMAKE_DEFAULT_INCDIRS="" ${pkgname}.pro
    make
}

package() {
    cd "${srcdir}/${pkgname}-${pkgver}"
    make -j2
    make INSTALL_ROOT="${pkgdir}/" install
    mkdir -p ${pkgdir}/usr/share/{kde4/services,kservices5}/ServiceMenus/
    mv ${pkgdir}/usr/share/doc/${pkgname}/${pkgname}-scan.desktop                  ${pkgdir}/usr/share/kde4/services/ServiceMenus/${pkgname}-scan.desktop 
    mv ${pkgdir}/usr/share/doc/${pkgname}/${pkgname}-download.desktop              ${pkgdir}/usr/share/kde4/services/ServiceMenus/${pkgname}-download.desktop
    cp ${pkgdir}/usr/share/kde4/services/ServiceMenus/${pkgname}-scan.desktop      ${pkgdir}/usr/share/kservices5/ServiceMenus/${pkgname}-scan.desktop
    cp ${pkgdir}/usr/share/kde4/services/ServiceMenus/${pkgname}-download.desktop  ${pkgdir}/usr/share/kservices5/ServiceMenus/${pkgname}-download.desktop
}
